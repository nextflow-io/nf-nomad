plugins {
    id 'nf-nomad@latest'
}

process {
    executor = "nomad"
}

aws {
    accessKey = secrets.SUN_NOMADLAB_ACCESS_KEY
    secretKey = secrets.SUN_NOMADLAB_SECRET_KEY
    client {
        endpoint = 'http://100.119.165.23:9000'
    }
}

wave {
    enabled = true
}

fusion {
    enabled = true
    exportStorageCredentials = true
}

nomad {

    client {
        address = 'http://100.119.165.23:4646'
    }

    jobs {
        deleteOnCompletion = false
        volumes = [
                { type "csi" name "juicefs-volume" }
        ]
        constraints = {

            node {
                unique = [name: "nomad02"]
            }

            attr {
                unique = [hostname:'nomad02']
                //raw 'platform.aws.instance-type', '=', 'm4.xlarge'
            }
        }
    }
}
